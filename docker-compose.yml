version: '3'
services:
  atlas-r:
    build:
      context: './redis/'
    image: atlas-r
    container_name: atlas-r
    #command: redis-server /usr/redis/redis-cluster.conf --requirepass changeme
    expose:
      - "6379"
    networks:
        atlas:
          aliases:
            - atlas-r
    restart: on-failure
    env_file: .env-atlas-r

  atlas-s:
    build:
      context: './atlas/'
    image: atlas-s
    depends_on:
            - atlas-r
    container_name: atlas-s
    networks:
      atlas:
        aliases:
          - atlas-s
    ports:
      - '${QUERYPORT}:${QUERYPORT}/udp' #Query UDP
      - '${QUERYPORT}:${QUERYPORT}' #Query TCP
      - '${SEAMLESSPORT}:${SEAMLESSPORT}' #Seamless TCP
      - '${GAMEPORT1}:${GAMEPORT1}/udp' #Gameport1 UDP
      - '${GAMEPORT2}:${GAMEPORT2}/udp' #Gameport2 UDP
      - '${RCONPORT}:${RCONPORT}' #RCON Port TCP
    env_file: .env-atlas-s
    volumes:
      - "~/.atlas:/home/steam/.atlas"

networks:
  atlas:
    driver: bridge
