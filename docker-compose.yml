version: '3'
services:
  atlas-r:
    build:
      context: './redis/'
    image: atlas-r
    container_name: atlas-r
    #command: redis-server /usr/redis/redis-cluster.conf --requirepass changeme
    expose:
      - "6379"
    networks:
        atlas:
          aliases:
            - atlas-r
    restart: on-failure
    env_file: .env-atlas-r

  atlas-s:
    build:
      context: './atlas/'
    image: atlas-s
    depends_on:
            - atlas-r
    container_name: atlas-s
    networks:
      atlas:
        aliases:
          - atlas-s
    ports:
      - target: 27018
        published: 27018
        protocol: udp
        mode: host
      - target: 270198
        published: 27019
        protocol: udp
        mode: host
      - target: 27020
        published: 27020
        protocol: tcp
        mode: host
      - target: 27021
        published: 27021
        protocol: tcp
        mode: host
    env_file: .env-atlas-s

networks:
  atlas:
    driver: bridge
